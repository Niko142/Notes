(()=>{"use strict";const e={initStorage(){localStorage.getItem("data")||localStorage.setItem("data",JSON.stringify([{text:"Первая заметка"}]))},getDataFromStorage:()=>JSON.parse(localStorage.getItem("data")||[]),saveDataToStorage(e){localStorage.setItem("data",JSON.stringify(e))}},t=(e="Ошибка: недопустимый размер записи")=>{const t=document.createElement("div");t.className="alert";const n=document.createElement("p");n.textContent=e,t.appendChild(n),document.body.append(t),setTimeout((()=>t.remove()),3500)},n={addNote:async t=>{try{if(t.length<5||t.length>50)return{success:!1,error:"Ошибка: Недопустимый формат ввода"};const n=e.getDataFromStorage(),a={text:t};return n.push(a),e.saveDataToStorage(n),{success:!0}}catch(e){return console.error(e),{success:!1,error:e?.message||"Произошла ошибка со стороны сервера"}}},deleteNote(t){const n=e.getDataFromStorage();n.splice(t,1),e.saveDataToStorage(n)},editNote:async(t,n)=>{try{if(!t?.value)return{success:!1,error:"Поле не может быть пустым"};const a=t.value.trim();if(a.length<3||a.length>50)return{success:!1,error:"Ошибка: поле не соответствует формату ввода"};const o=e.getDataFromStorage();return o[n].text=a,e.saveDataToStorage(o),{success:!0}}catch(e){return console.error(e),{success:!1,err:e?.message||"Произошла ошибка со стороны сервера"}}}};let a={currentPage:1,totalRecords:1,totalItems:0,notesPerPage:4};const o={getPaginatedData(e){const t=(a.currentPage-1)*a.notesPerPage,n=t+a.notesPerPage;return e.slice(t,n)},updateTotalItems(e){a.totalItems=e,a.totalRecords=Math.ceil(e/a.notesPerPage),a.currentPage>a.totalRecords&&a.totalRecords>0&&(a.currentPage=a.totalRecords),a.currentPage<1&&(a.currentPage=1)},nextPage:()=>a.currentPage<a.totalRecords&&(a.currentPage++,!0),prevPage:()=>a.currentPage>1&&(a.currentPage--,!0),resetPage(){a.currentPage=1},getPaginationState:()=>({currentPage:a.currentPage,totalRecords:a.totalRecords,totalItems:a.totalItems,notesPerPage:a.notesPerPage,hasNextPage:a.currentPage<a.totalRecords,hasPrevPage:a.currentPage>1}),setnotesPerPage(e){a.notesPerPage=e,this.updateTotalItems(a.totalItems)}};const r=document.querySelector(".btn.btn--add"),s=document.querySelector(".pagination__btn--prev"),c=document.querySelector(".pagination__btn--next"),u=document.querySelector(".notes__list"),l=document.querySelector("#add-note"),i=document.querySelector("#search-note");function d(t=null,n=!1){n&&o.resetPage(),function(t,n,a=null){t.innerHTML="";const r=a||e.getDataFromStorage(),s=n.value.trim(),c=s?function(e,t){if(!t.trim())return e;const n=t.toLowerCase();return e.filter((e=>e.text.toLowerCase().includes(n)))}(r,s):r;o.updateTotalItems(c.length);const u=o.getPaginatedData(c),{currentPage:l,totalRecords:i}=o.getPaginationState();if(function(e,t){const n=document.querySelector(".pagination__current"),a=document.querySelector(".pagination__total"),r=document.querySelector(".pagination__btn--prev"),s=document.querySelector(".pagination__btn--next");n.textContent=e,a.textContent=t;const{hasPrevPage:c,hasNextPage:u}=o.getPaginationState();r.disabled=!c,s.disabled=!u}(l,i),0===u.length){const e=s?`Заметки по запросу "${s}" не найдены...`:"Заметки отсутствуют...";return void(t.innerHTML=`<p style="font-size: 1.5rem;">${e}</p>`)}const d=e.getDataFromStorage(),g=u.map((e=>{const t=d.findIndex((t=>t.text===e.text));return((e,t)=>`\n      <li class="notes__item" data-note-id=${t}>\n        <p class="notes__text">${e.text}</p>\n        <menu class="btn__toolbar">\n          <button class="btn btn--update" data-id=${t} data-type="edit">Редактировать</button>\n          <button class="btn btn--delete" data-id=${t} data-type="delete">Удалить</button>\n        </menu>\n      </li>\n    `)(e,t)})).join("");t.insertAdjacentHTML("beforeend",g)}(u,i,t)}async function g(){const e=l.value.trim(),a=await n.addNote(e);a.success?(i.value="",d()):(l.focus(),t(a?.error||"Ошибка: недопустимый раз записи")),l.value=""}function m(e){n.deleteNote(e),d()}async function P(e){const a=document.querySelector(".notes__input.notes__input--edit"),o=await n.editNote(a,e);o.success?(i.value="",d()):(a.focus(),t(o?.error||"Ошибка: недопустимый формат записи"))}function p(){d()}(()=>{e.initStorage(),d(),r.addEventListener("click",g);const t={delete:e=>{m(e)},edit:t=>{!function(t){d(),function(t){const n=e.getDataFromStorage(),a=document.querySelector(`[data-note-id="${t}"]`);a?(a.innerHTML="",a.insertAdjacentHTML("beforeend",((e,t)=>`\n      <input type="text" class="notes__input notes__input--edit" value="${e.text}"></input>\n      <menu class='btn__toolbar'>\n        <button class="btn btn--save" data-id=${t} data-type="save">Сохранить</button>\n        <button class="btn btn--cancel" data-id=${t} data-type="cancel">Отмена</button>\n      </menu>\n    `)(n[t],t))):console.warn(`Не найден <li> с data-note-id="${t}"`)}(t)}(t)},save:e=>{P(e)},cancel:p};u.addEventListener("click",(e=>{const{type:n,id:a}=e.target.dataset,o=t[n];o&&o(a)})),l.addEventListener("keypress",(e=>{"Enter"===e.key&&g()}));let n=null;i.addEventListener("input",(()=>{clearTimeout(n),n=setTimeout(d,300)})),i.addEventListener("focus",(()=>{i.style.backgroundImage="url('')"})),i.addEventListener("blur",(()=>{0===i.value.length&&(i.style.backgroundImage="url('./images/loupe.png')")})),i.addEventListener("keydown",(e=>{"Escape"===e.key&&function(e,t){e.value="",t()}(i,d)})),s.addEventListener("click",(()=>{o.prevPage()&&d()})),c.addEventListener("click",(()=>{o.nextPage()&&d()}))})()})();